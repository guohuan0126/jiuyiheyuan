<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.duanrong.drpay.business.demand.mapper.DemandtreasureTransferOutMapper">
	<resultMap type="DemandtreasureTransferOut" id="DemandtreasureTransferOutRM">
		<id property="id" column="id" />
		<result property="userId" column="user_id" />
		<result property="money" column="money" />
		<result property="principal" column="principal" />
		<result property="interest" column="interest" />
		<result property="sendedTime" column="sended_Time" />
		<result property="successTime" column="success_time" />
		<result property="transferWay" column="trnsfer_way" />
		<result property="status" column="status" />
		<result property="detail" column="detail" />
	</resultMap>
	
	
	
	<insert id="insert" parameterType="DemandtreasureTransferOut">
		INSERT INTO demand_treasure_transferout
		(id, user_id, money,principal, interest,sended_time,success_time,trnsfer_way,status,detail) 
		VALUES
		(#{id}, #{userId}, #{money},#{principal},#{interest}, #{sendedTime}, #{successTime}, #{transferWay}, #{status}, #{detail})
	</insert>
	
	<!-- 按状态获取用户转出总额 -->
	<select id="getOutMoneySumByStatus" parameterType="map" resultType="double">
		SELECT SUM(principal) FROM demand_treasure_transferout 
		WHERE status = #{status} AND user_id = #{userId}
	</select>
	
	
	<resultMap type="DemandtreasureTransferOut" id="DemandtreasureTransferOutRM1">	
		<result property="principal" column="principal" />
		<result property="money" column="money" />
		<result property="interest" column="interest" />
	</resultMap>
	
	<select id="getOutSumMoney" parameterType="map" resultMap="DemandtreasureTransferOutRM1">
		SELECT SUM(money) as money, SUM(interest) as interest, SUM(principal) AS principal  FROM demand_treasure_transferout 
		WHERE status = #{status} AND user_id = #{userId}
	
	</select>
	
	<!-- 按状态获取用户转出利息 -->
	<select id="getOutInterestSumByStatus" parameterType="map" resultType="double">
		SELECT SUM(interest) FROM demand_treasure_transferout 
		WHERE status = #{status} AND user_id = #{userId}
	</select>
	<select id="pageLite" parameterType="DemandtreasureTransferOut" resultMap="DemandtreasureTransferOutRM">
		SELECT * FROM demand_treasure_transferout 
		WHERE status in ('sended', 'success') AND user_id = #{userId} order by sended_time desc
	</select>
	
	<!-- 获取用户当天转出记录数 -->
	<select id="getValidOutCount" parameterType="map" resultType="int">
		SELECT count(*)
		FROM demand_treasure_transferout
		WHERE user_id = #{userId}
		AND date(sended_Time) = CURDATE()
		AND trnsfer_way !='expires'
	</select>
	
	
	<!-- 获取用户当天转出记录数 -->
	<select id="getValidOutSumMoney" parameterType="string" resultType="double">
		SELECT IFNULL(sum(principal),0)
		FROM demand_treasure_transferout
		WHERE status in('success', 'sended') and user_id = #{userId}
		AND date(sended_Time) = CURDATE()
	</select>
</mapper>