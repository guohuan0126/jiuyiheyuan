<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.duanrong.business.user.mapper.UserLoginLogMapper">
	<resultMap type="UserLoginLog" id="userLoginLogRM">
		<id property="id" column="login_id" />
		<result property="userId" column="user_id" />
		<result property="loginTime" column="login_time" />
		<result property="loginIp" column="login_ip" />
		<result property="isSuccess" column="is_success" />
		<result property="loginInfo" column="login_info" />
		<result property="num" column="num" />
	</resultMap>

	<insert id="insert" parameterType="UserLoginLog">
		INSERT INTO user_login_log
		(id, user_id, login_time, login_ip, is_success, login_info)
		VALUES
		(#{id}, #{userId}, NOW(), #{loginIp}, #{isSuccess}, #{loginInfo})
	</insert>

	<select id="getByUserId" parameterType="string" resultMap="userLoginLogRM">
		SELECT *, id AS user_id
		FROM user_login_log
		WHERE user_id = #{userId}
		AND is_success = '1'
		ORDER BY login_time DESC
		LIMIT 1
	</select>
	
	<select id="getLastLoginTime" parameterType="string" resultType="date">
		SELECT login_time
		FROM user_login_log
		WHERE user_id = #{userId}
		AND is_success = '1'
		ORDER BY login_time DESC
		LIMIT 2
	</select>
	
		<!-- 分页查询 -->
	<select id="pageLite" parameterType="UserLoginLog" resultMap="userLoginLogRM" >
	  	SELECT * FROM
		user_login_log
		<where>
		<if test="startTime != null and startTime != '' ">
			and user_login_log.login_time &gt;=#{startTime}
		</if>
		<if test="endTime != null and endTime != '' ">
			and user_login_log.login_time &lt;=#{endTime}
		</if>
		<if test="loginIp != null and loginIp != '' ">
			and user_login_log.login_ip =#{loginIp}
		</if>
		<if test="isSuccess != null and isSuccess != '' ">
			and user_login_log.is_success =#{isSuccess}
		</if>
		<if test="userId != null and userId != '' ">
			and user_login_log.user_id =#{userId}
		</if>
		</where>
		ORDER BY login_time DESC
	</select>
</mapper>