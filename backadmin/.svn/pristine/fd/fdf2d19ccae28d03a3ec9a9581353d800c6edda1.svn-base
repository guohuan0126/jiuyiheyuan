                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 package com.duanrong.newadmin.controller.ruralfinance;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.regex.Pattern;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.lang3.StringUtils;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.commons.CommonsMultipartFile;
import org.springframework.web.servlet.ModelAndView;

import util.MyStringUtils;
import base.pagehelper.PageInfo;

import com.duanrong.business.ruralfinance.dao.AgricultureDebitRecordsDao;
import com.duanrong.business.ruralfinance.model.AgricultureDebitRecords;
import com.duanrong.business.ruralfinance.model.AgricultureLoaninfo;
import com.duanrong.business.ruralfinance.model.AgricultureRepaymentPlan;
import com.duanrong.business.ruralfinance.model.AgricultureTimelyloansPrepayment;
import com.duanrong.business.ruralfinance.service.AgricultureDebitRecordsService;
import com.duanrong.business.ruralfinance.service.AgricultureLoaninfoService;
import com.duanrong.business.ruralfinance.service.AgricultureTimelyloansPrepaymentService;
import com.duanrong.newadmin.controllhelper.UserCookieHelper;
import com.duanrong.newadmin.model.UserCookie;
import com.duanrong.newadmin.utility.IdGenerator;
import com.duanrong.newadmin.utility.RegexInput;

@Controller
public class ImportPrepaymentController {

	// 

	@Autowired
	@Resource
	private AgricultureLoaninfoService agricultureLoaninfoService;
	@Resource
	private AgricultureTimelyloansPrepaymentService agricultureTimelyloansPrepaymentService;
	private Boolean jy = true;
	// 
	private int sjErr = 0;
	// 
	private int bhErr = 0;
	// 
	private List<AgricultureTimelyloansPrepayment> contractDataErrList = new ArrayList<AgricultureTimelyloansPrepayment>();
	private List<AgricultureTimelyloansPrepayment> contractDataErrListAno = new ArrayList<AgricultureTimelyloansPrepayment>();
	// 
	private List<String> contractHTErrList = new ArrayList<String>();
	private List<String> contractHTErrListAno = new ArrayList<String>();
	// 

	private List<String> contractIsFK = new ArrayList<String>();
	// 
	private List<AgricultureTimelyloansPrepayment> saveAll = new ArrayList<AgricultureTimelyloansPrepayment>();
	private InputStream stream1;

	// excle
	private List<String> contractExcleCF = new ArrayList<String>();

	@RequestMapping(value = "/agricultural/impTimelyloansPrepayment")
	public ModelAndView impzhongjinDebit(Model model,
			HttpServletRequest request, HttpServletResponse response) {

		int pageNo = 1;
		int pageSize = 20;
		if (MyStringUtils.isNumeric(request.getParameter("pageNo"))) {
			pageNo = Integer.parseInt(request.getParameter("pageNo"));
		}
		model.addAttribute("bl", 1);
		Map<String, String> map = new HashMap<String, String>();
		map.put("pageNo", String.valueOf(pageNo));
		map.put("pageSize", String.valueOf(pageSize));
		PageInfo pageInfo = agricultureLoaninfoService.readUploadPrepaymentUser(
				pageNo, pageSize, "1");
		model.addAttribute("list", pageInfo.getResults());
		model.addAttribute("pageInfo", pageInfo);

		return new ModelAndView("ruralfinance/impTimelyloansPrepayment");
	}

	/**
	 * 
	 * 
	 * @return
	 */
	@RequestMapping(value = "/showPrepayment", method = RequestMethod.GET)
	public String showPrepayment() {

		return "redirect:/agricultural/impTimelyloansPrepayment?type=1";
	}

	// 1.Excel
	public void inputExcel(CommonsMultipartFile file,
			HttpServletRequest request, HttpServletResponse response, int type,String uploadExcelId)
			throws Exception {
		InputStream input = file.getInputStream();
		ByteArrayOutputStream baos = new ByteArrayOutputStream();
		byte[] buffer = new byte[1024];
		int len;
		while ((len = input.read(buffer)) > -1) {
			baos.write(buffer, 0, len);
		}
		baos.flush();
		stream1 = new ByteArrayInputStream(baos.toByteArray());
		jy = true;
		// excle
		contractDataErrList.clear();
		contractHTErrList.clear();
		contractExcleCF.clear();
		contractDataErrListAno.clear();
		contractHTErrListAno.clear();
		bhErr = 0;
		sjErr = 0;
		// type
		if (type == 0) {

		} else {
			impExcel(stream1, request, response,uploadExcelId,file);
		}
	}

	@ResponseBody
	@RequestMapping(value = "/showPrepayment", method = RequestMethod.POST)
	public ModelAndView impData(
			@RequestParam("file") CommonsMultipartFile file,
			HttpServletRequest request, HttpServletResponse response,
			Model model) throws Exception {
		//excelid
		String uploadExcelId = IdGenerator.randomUUID();
		// 1.
		inputExcel(file, request, response, 1,uploadExcelId);
		// 
		if (sjErr == 1 || bhErr == 1) {
			// 
			for (int i = 0; i < contractDataErrList.size(); i++) {
				if (contractDataErrList.get(i) != null
						&& contractDataErrList.get(i).getId() != null) {
					contractDataErrListAno.add(contractDataErrList.get(i));
				}
			}
			model.addAttribute("contractDataErrList", contractDataErrListAno);
			model.addAttribute("contractHTErrList", contractHTErrList);
			// 
		} else {
			// oss
			agricultureTimelyloansPrepaymentService.uploadFile(file, request, response,uploadExcelId);
			PageInfo pageInfo = agricultureLoaninfoService.readUploadPrepaymentUser(
					1, 20, "1");
			model.addAttribute("list", pageInfo.getResults());
			model.addAttribute("pageInfo", pageInfo);
			String type = request.getParameter("type");
			if (type == null) {
				model.addAttribute("sc", "success");
			}
		}
		return new ModelAndView("ruralfinance/impTimelyloansPrepayment");
	}

	/**
	 * Excel
	 * 
	 * @param execelFile
	 * @throws Exception
	 */
	@SuppressWarnings("unchecked")
	public  boolean impExcel(InputStream execelFile, HttpServletRequest request,
			HttpServletResponse response,String uploadExcelId,CommonsMultipartFile files) throws Exception{  
		  //  Workbook execelFile (Excel)  
		 Workbook book = null;  
		try {       
          String realName = files.getOriginalFilename();
			String ext = realName.substring(realName.lastIndexOf(".")); 
			  if(".xls".equals(ext)){  
				// Excel 2003
					book = new HSSFWorkbook(execelFile);  
	            }else if(".xlsx".equals(ext)){  
	            	// Excel 2007
	    			book = new XSSFWorkbook(execelFile);
	            }  		
          	// sheet  
              Sheet sheet = book.getSheetAt(0);  
          	//  rowcell  
          	org.apache.poi.ss.usermodel.Row row;  
          	// ,0  
              row = sheet.getRow(2);  
              // ,0  
              @SuppressWarnings("unused")
				int totalCells = row.getLastCellNum() ;  
              
              org.apache.poi.ss.usermodel.Row rowSec=sheet.getRow(2);
        	  List<AgricultureTimelyloansPrepayment> agricultureTimelyloansPrepayments=new ArrayList<AgricultureTimelyloansPrepayment>();
              //
        	  AgricultureTimelyloansPrepayment agricultureTimelyloansPrepayment=null;
        	contractHTErrList.clear();
        	contractExcleCF.clear();
        	saveAll.clear();
        	//excle
        	//
        	for(int f=2;f<sheet.getLastRowNum()+1;f++){
	          	Row rr=	sheet.getRow(f);
	          	if(rr==null){
	          		
	          	}else{
	          		Cell currentContent = rr.getCell(11);
	          		if(currentContent==null){
	          		}else{
	          			contractExcleCF.add(currentContent.toString());
	          		}
	          	}
        	}
        	
          for  ( int  i=0;i<contractExcleCF.size() ; i ++ )   {
          	 //
        	 Map map1=new HashMap<>();
  			map1.put("byType", "1");
  			map1.put("contractId",contractExcleCF.get(i));
  			AgricultureTimelyloansPrepayment  AgricultureTimelyloansPrepayment1  =agricultureTimelyloansPrepaymentService.findByCondition(map1);
        	  if(AgricultureTimelyloansPrepayment1==null){
        		  
        	  }else{
        		  contractHTErrList.add(contractExcleCF.get(i));
        	  }
              for  ( int  j =contractExcleCF.size()-1 ; j  >  i; j -- )   { 
                if  (contractExcleCF.get(j).equals(contractExcleCF.get(i)))   { 
              	  contractHTErrList.add(contractExcleCF.get(i));
                }else{
              	  System.out.println(contractExcleCF.get(i));
              	  //
              	  Map map=new HashMap<>();
        			map.put("byType", "1");
        			map.put("contractId",contractExcleCF.get(i));
        			//
        			AgricultureTimelyloansPrepayment  AgricultureTimelyloansPrepayment =agricultureTimelyloansPrepaymentService.findByCondition(map);
              	  if(AgricultureTimelyloansPrepayment==null){
              		  
              	  }else{
              		  contractHTErrList.add(contractExcleCF.get(i));
              	  }
                } 
              } 
            } 
        //  
        	if(contractHTErrList.size()>0){
        		bhErr=1;
        			Set<String>  set=new HashSet<String>(contractHTErrList);
        			contractHTErrList.clear();
        			contractHTErrList.addAll(set);
        		return false;
        	}else{
        	//	
        		
        	}
              for(int y=2;y<sheet.getLastRowNum()+1;y++){
              //	
              int	yhm=0;
          	//
              int	sfzh=0;
              //
              int sjh=0;
              //
              int	yhkh=0;
              //
              int	fkrq=0;
              //
              int	yhmc=0;
              // 
              int	yhfh=0;
              //
              int	sf=0;
              //
              int	cs=0;
              //
              int	htje=0;
              //
              int	fkje=0;
              //
              int	fwf=0;
              //
              int	jkqx=0;
          	  //
          	  int sftqhk=0;
          	  //
          	  int sfhq=0;
          	  //
          	  int sjtime=0;
          	  //
          	  int sjqx=0;
              //
              int depart=0;
              //
              int hkfs=0;
              jy=true;
              	row = sheet.getRow(y);
              	agricultureTimelyloansPrepayment=new AgricultureTimelyloansPrepayment();
          		
          	//
          	for(int t=1;t<rowSec.getLastCellNum();t++){
          		if(row==null){
          			
          		}else{
          			String uuid = IdGenerator.randomUUID();
          			agricultureTimelyloansPrepayment.setId(uuid);
          			agricultureTimelyloansPrepayment.setFlag(0);
          			agricultureTimelyloansPrepayment.setUploadExcelId(uploadExcelId);
					SimpleDateFormat sdf1 = new SimpleDateFormat(
							"yyyy-MM-dd HH:mm:ss");
					// 
              		//
              		if(t==1&&isOK(1,row)){
              			agricultureTimelyloansPrepayment.setName(row.getCell(1).toString());
              		}else if(t==1&&!isOK(1,row)) {
              			yhm=1;
          				jy=false; 
          				agricultureTimelyloansPrepayment.setName("");
          				if(row.getCell(1)!=null){
          					agricultureTimelyloansPrepayment.setName(row.getCell(1).toString());
          				}
              		}
              		//
              		if(t==2&&isOK(2,row)){
              			
              			if(row.getCell(2).toString() != null && row.getCell(2).toString().contains("")){
              				agricultureTimelyloansPrepayment.setTypeOfId("1");
              			}else if(row.getCell(2).toString() != null && row.getCell(2).toString().contains("")){
              				agricultureTimelyloansPrepayment.setTypeOfId("0");
              			}
              			
              		}
              		//		
              		if(t==3&&isOK(3,row)){
              			
              			if(row.getCell(3).toString().length()!=18){
              				sfzh=1;
              				agricultureTimelyloansPrepayment.setIdCard(row.getCell(3).toString());
              				jy=false;
              				System.out.println("");
              			}else{             				
              				agricultureTimelyloansPrepayment.setIdCard(row.getCell(3).toString());                  			                 		                  			
              			}
              			
              		}else if(t==3&&!isOK(3,row)){
              			sfzh=1;
          				jy=false;
          				agricultureTimelyloansPrepayment.setIdCard("");
              		}              		
              		//
              		if(t==4&&isOK(4,row)){
              			if(!RegexInput.isNumber(row.getCell(4).toString())||row.getCell(4).toString().length()!=11){
              				sjh=1;
              				jy=false;
              				System.out.println("");
              				agricultureTimelyloansPrepayment.setMobileNumber(row.getCell(4).toString());
              			}else{
              				agricultureTimelyloansPrepayment.setMobileNumber(row.getCell(4).toString());
              			}
              		}else if(t==4&&!isOK(4,row)){
              			sjh=1;
          				jy=false; 
              		}
              		//
              		if(t==5&&isOK(5,row)){
              			String custType = row.getCell(5).toString();
          				if(custType.equals("")){
          					agricultureTimelyloansPrepayment.setCustomerType("0");
          				}else{
          					agricultureTimelyloansPrepayment.setCustomerType("1");
          				}
            				
              		}else if(t==5&&!isOK(5,row)){
              			jy=false;
              		}
              		
              		//
              		if(t==6&&isOK(6,row)){
              			agricultureTimelyloansPrepayment.setBank(row.getCell(6).toString());
              			
              		}else if(t==6&&!isOK(6,row)){
              			yhmc=1;
          				jy=false; 
              		}
              		//
              		if(t==7&&isOK(7,row)){
              			if(!RegexInput.isNumber(row.getCell(7).toString())){
              				yhkh=1;
              				jy=false;
              				System.out.println("");
              				agricultureTimelyloansPrepayment.setBankcard(row.getCell(7).toString());
              			}else{
              				agricultureTimelyloansPrepayment.setBankcard(row.getCell(7).toString());
              			}
              		
              		}else if(t==7&&!isOK(7,row)){
              			yhkh=1;
          				jy=false;
          				agricultureTimelyloansPrepayment.setBankcard("");
              		}
              		//
              		if(t==8&&isOK(8,row)){
              			agricultureTimelyloansPrepayment.setBranchname(row.getCell(8).toString());
              		}else if(t==8&&!isOK(8,row)){
              			yhfh=1;
          				jy=false;
              		}
              		//
              		if(t==9&&isOK(9,row)){
              			agricultureTimelyloansPrepayment.setProvince(row.getCell(9).toString());
          		     }else if(t==9&&!isOK(9,row)){
          				sf=1;
          				jy=false;
              		}
              		//
              		if(t==10&&isOK(10,row)){
              			agricultureTimelyloansPrepayment.setCity(row.getCell(10).toString());
              		
              		}else if(t==10&&!isOK(10,row)){
              			cs=1;
          				jy=false;         				
              		}
              	//
              		if(t==11&&isOK(11,row)){
              			if(RegexInput.ishanzi(row.getCell(11).toString())){
              				jy=false;
              				System.out.println("");
              				agricultureTimelyloansPrepayment.setContractId(row.getCell(11).toString());
              			}else{
              				agricultureTimelyloansPrepayment.setContractId(row.getCell(11).toString());
              			}
              		}
              	//
              		if(t==12&&isOK(12,row)){
              			String repayType = row.getCell(12).toString();
              		    if(!repayType.equals("")){
              			hkfs=1;
          				jy=false;
			  			}else{
			  				agricultureTimelyloansPrepayment.setRepayType(row.getCell(12).toString());
			  			}
          		   }
              	//
              		if(t==13&&isOK(13,row)){
              			String loanTerm = row.getCell(13).toString().replace(".0", "");
              			agricultureTimelyloansPrepayment.setLoanTerm(Integer.parseInt(loanTerm));
              		}else if(t==13&&!isOK(13,row)){
              			jkqx=1;
          				jy=false;
              		}
              	//
              		if(t==14&&isOK(14,row)){             			
              			SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd");
              			Date da = sdf.parse(row.getCell(14).toString());
              			agricultureTimelyloansPrepayment.setGiveMoneyTime(da);
              		}else if(t==14&&!isOK(14,row)){
              			jy=false;
              			fkrq=1;
              		}            		
              		
              		//
              		if(t==15&&isOK(15,row)){
              			agricultureTimelyloansPrepayment.setMoney(Double.parseDouble(row.getCell(15).toString()));             			
              		}else if(t==15&&!isOK(15,row)){
              			htje=1;
          				jy=false;
              		}
              		//
              		if(t==16&&isOK(16,row)){
              			agricultureTimelyloansPrepayment.setLoanMoney(Double.parseDouble(row.getCell(16).toString()));             			
              		}else if(t==16&&!isOK(16,row)){
              			fkje=1;
          				jy=false;
              		}
              		//
              		if(t==17&&isOK(17,row)){
              			agricultureTimelyloansPrepayment.setServiceMoney(Double.parseDouble(row.getCell(17).toString()));
              		}else if(t==17&&!isOK(17,row)){
              			fwf=1;
          				jy=false;
              		}
              	//
              		if(t==18&&isOK(18,row)){
              				String department = row.getCell(18).toString();
              				if(department.equals("")){
              					agricultureTimelyloansPrepayment.setAccountingDepartment(1);
              				}else if(department.equals("")){
              					agricultureTimelyloansPrepayment.setAccountingDepartment(2);
              				}
              		}else if(t==18&&!isOK(18,row)){
              			jy=false;
              			depart=1;
              		}
              		//
              		if(t==19&&isOK(19,row)){
              			String  whetherEarlyRepayment= row.getCell(19).toString();
              		    if(!whetherEarlyRepayment.equals("")){
              		    sftqhk=1;
          				jy=false;
			  			}else{
			  				agricultureTimelyloansPrepayment.setWhetherEarlyRepayment("");;
			  			}
              		}else if(t==19&&!isOK(19,row)){
              			sftqhk=1;
          				jy=false;
              		}
              	//
              		if(t==20&&isOK(20,row)){
              			agricultureTimelyloansPrepayment.setActualLoanTerm(row.getCell(20).toString().replace(".0", ""));            			
              		}else if(t==20&&!isOK(20,row)){
              			sjqx=1;
          				jy=false;
              		}
              	//
              		if(t==21&&isOK(21,row)){  
              			SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd");
              			Date da = sdf.parse(row.getCell(21).toString());           	          		
              		    if(da.getTime()<new Date().getTime()){
              		    sjtime=1;
          				jy=false;
			  			}else{
			  				agricultureTimelyloansPrepayment.setActualEndTime(da);;
			  			}
              		}else if(t==21&&!isOK(21,row)){
              			sjtime=1;
          				jy=false;
              		}
              	//
              		if(t==22&&isOK(22,row)){
              			agricultureTimelyloansPrepayment.setWhetherSettlement(row.getCell(22).toString());            			
              		}else if(t==22&&!isOK(22,row)){
              			sfhq=1;
          				jy=false;
              		}
          		}
          		
              }
          	//
          	if(!jy){
          		sjErr=1;
          	}
          	if(agricultureTimelyloansPrepayment.getContractId()==null){
          		
          	}else{          		
          		Map map=new HashMap<>();
      			map.put("byType", "1");
      			map.put("contractId",agricultureTimelyloansPrepayment.getContractId());
      			AgricultureTimelyloansPrepayment agricultureTimelyloansPrepayment2 =agricultureTimelyloansPrepaymentService.findByCondition(map);
      			//
      			if(agricultureTimelyloansPrepayment2==null){
      				saveAll.add(agricultureTimelyloansPrepayment);
      			}else{
      				//
      				bhErr=1;
      			}
          	}
          	//
          	if(yhm==1){
          		agricultureTimelyloansPrepayment.setYhm(1);
          	}
          	if(sfzh==1){
          		agricultureTimelyloansPrepayment.setSfzh(1);
          	}if(sjh==1){
          		agricultureTimelyloansPrepayment.setSjh(1);
          	}if(yhkh==1){
          		agricultureTimelyloansPrepayment.setYhkh(1);
          	}if(fkrq==1){
          		agricultureTimelyloansPrepayment.setFkrq(1);
          	}if(yhmc==1){
          		agricultureTimelyloansPrepayment.setYhmc(1);
          	}if(yhfh==1){
          		agricultureTimelyloansPrepayment.setYhfh(1);
          	}if(sf==1){
          		agricultureTimelyloansPrepayment.setSf(1);
          	}if(cs==1){
          		agricultureTimelyloansPrepayment.setCs(1);
          	}if(htje==1){
          		agricultureTimelyloansPrepayment.setHtje(1);
          	}if(fkje==1){
          		agricultureTimelyloansPrepayment.setFkje(1);
          	}if(fwf==1){
          		agricultureTimelyloansPrepayment.setFwf(1);
          	}if(jkqx==1){
          		agricultureTimelyloansPrepayment.setJkqx(1);
          	}if(depart==1){
          		agricultureTimelyloansPrepayment.setDepart(1);
          	}if(hkfs==1){
          		agricultureTimelyloansPrepayment.setHkfs(1);
          	}if(sftqhk==1){
          		agricultureTimelyloansPrepayment.setSftqhk(1);
          	}if(sfhq==1){
          		agricultureTimelyloansPrepayment.setSfhq(1);
          	}if(sjtime==1){
          		agricultureTimelyloansPrepayment.setSjtime(1);
          	}if(sjqx==1){
          		agricultureTimelyloansPrepayment.setSjqx(1);
          	}
          	
          	if(yhm==1||sfzh==1||sjh==1||yhkh==1||fkrq==1||yhmc==1||yhfh==1||sf==1||cs==1||
          			htje==1||fkje==1||fwf==1||jkqx==1||depart==1||hkfs==1||sftqhk==1||sjtime==1||sfhq==1||sjqx==1
          			){
          		contractDataErrList.add(agricultureTimelyloansPrepayment);
          	}
          	 
            }
              //
              if(bhErr==1||sjErr==1){
              	return false;
              }else{
              	//excle
              	if(bhErr==1){
              		return false;
              	}else{
              		for(int i=0;i<saveAll.size();i++){
              			if(saveAll.get(i).getBranchname()==null){
                  			saveAll.get(i).setBranchname("");
                  		}
              			agricultureTimelyloansPrepaymentService.saveAgricultureTimelyloansPrepayment(saveAll.get(i),"1");	
              		}
              		return true;
              	}
              }
              
      } catch (IOException e) {  
          e.printStackTrace();  
      }
		return false;  
  }
	
	public boolean isOK(int t, Row row) {
		return row != null && row.getCell(t) != null
				&& StringUtils.isNotBlank(row.getCell(t).toString());
	}
}
