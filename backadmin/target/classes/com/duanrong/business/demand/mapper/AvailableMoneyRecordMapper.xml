<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.duanrong.business.demand.mapper.AvailableMoneyRecordMapper">
	<resultMap type="AvailableMoneyRecord" id="AvailableMoneyRecordRM">
		<id property="id" column="id" />
		<result property="money" column="money" />
		<result property="begintime" column="beginTime" />
		<result property="endtime" column="endTime" />
		<result property="status" column="status" />
		<result property= "expectTime" column="expect_time"/>
		<result property="operateorid" column="operateorid" />
		<result property="type" column="type" />
		<result property="expiredMoney" column="expiredMoney" />
		<result property="realExpiredMoney" column="realExpiredMoney" />
		<result property="opendMoney" column="opendMoney" />
		<result property="flag" column="flag" />
		<result property="totalMoney" column="totalMoney" />
		<result property="transferMoney" column="transferMoney" />
		<result property="addMoney" column="addMoney" />
		<result property="createTime" column="createTime" />

	</resultMap>
	
    <select id="pageInfo"  resultMap="AvailableMoneyRecordRM">
		SELECT *
		FROM Demand_treasure_availableMoneyRecord where status !=0 order by beginTime desc
	</select>
	<insert id="insert" parameterType="AvailableMoneyRecord">
		INSERT INTO Demand_treasure_availableMoneyRecord <include refid="InfoManageSet" />
	</insert>
     
    <sql id="InfoManageSet">
         <set >
              <if test= "id != null">id=#{id},</if >
              <if test= "money != null">money=#{money},</if >
              <if test= "begintime != null">beginTime=#{begintime},</if >
              <if test= "endtime!= null">endTime=#{endtime},</if >
              <if test= "status != null">status=#{status},</if >
              <if test= "operateorid != null">operateorid=#{operateorid},</if>
              <if test="expectTime != null">expect_time=#{expectTime},</if>
              <if test="type != null">type=#{type},</if>
              <if test="expiredMoney != null">expiredMoney=#{expiredMoney},</if>
              <if test="realExpiredMoney != null">realExpiredMoney=#{realExpiredMoney},</if>
              <if test="opendMoney != null">opendMoney=#{opendMoney},</if>
              <if test="flag != null">flag=#{flag},</if>
              <if test="totalMoney != null">totalMoney=#{totalMoney},</if>
              <if test="transferMoney != null">transferMoney=#{transferMoney},</if>
              <if test="addMoney != null">addMoney=#{addMoney},</if>
          </set>
    </sql>
    
    
    <update id="del" parameterType="AvailableMoneyRecord">
		UPDATE Demand_treasure_availableMoneyRecord
		set status=#{status},operateorid=#{operateorid}
		WHERE id=#{id}
	</update>
	<update id="update" parameterType="AvailableMoneyRecord">
		UPDATE Demand_treasure_availableMoneyRecord 
		<set>
			<if test="money != null">
				money=#{money},
			</if>
			<if test="expectTime != null">
				expect_time=#{expectTime},
			</if>
			<if test="begintime != null">
				beginTime=#{begintime},
			</if>
			<if test="endtime != null">
				endTime =#{endtime},
			</if>
			<if test="operateorid != null">
				operateorid =#{operateorid},
			</if>
			<if test="status != null">
				status =#{status},
			</if>
			<if test="opendMoney != null">
				opendMoney =#{opendMoney},
			</if>
			<if test="expiredMoney != null">
				expiredMoney =#{expiredMoney},
			</if>
			<if test="realExpiredMoney != null">
				realExpiredMoney =#{realExpiredMoney},
			</if>
			<if test="type != null">
				type =#{type},
			</if>
			<if test="flag != null">
				flag =#{flag},
			</if>
			<if test="totalMoney != null">
				totalMoney =#{totalMoney},
			</if>
			<if test="transferMoney != null">
				transferMoney =#{transferMoney},
			</if>
			<if test="addMoney != null">
				addMoney =#{addMoney},
			</if>
		</set>
		WHERE id=#{id}
	</update>
	<select id="getRecord"  resultMap="AvailableMoneyRecordRM">
		SELECT *
		FROM Demand_treasure_availableMoneyRecord where status !=0  and type in ('add','expired') ORDER BY beginTime desc limit 1
	</select>
	
	<select id="get" resultMap="AvailableMoneyRecordRM" parameterType="string">
		SELECT *
		FROM Demand_treasure_availableMoneyRecord where status !=0 and id=#{id}
	</select>
	<!-- 获取活期宝可用资产 -->
	<select id="getUserUsedMoney" resultType="double">
		SELECT available_money from demand_treasure 
	</select>
	<!-- 更新活期宝可用资产 -->
	<update id="updateDemandTreasure" parameterType="double">
		UPDATE demand_treasure
		set available_money=#{money}
	</update>
</mapper>