<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.duanrong.cps.business.activity.mapper.activityMapper">

	<resultMap type="com.duanrong.cps.business.activity.model.Activity" id="ActivityRM">
		<id property="id" column="id"  />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="startTime" column="startTime" />
		<result property="endTime" column="endTime" />
		<result property="createTime" column="createTime" />
		<result property="url" column="url" />
		<result property="imageUrl" column="image_url" />
		<result property="status" column="status" />
		<result property="isEnd" column="is_end" />
		<result property="type" column="type" />
		<result property="updateTime" column="updateTime" />
		<result property="target" column="target" />
		<association property="user" column="user_id"
			resultMap="com.duanrong.cps.business.user.mapper.UserMapper.userRM" />
	</resultMap>

   <!-- 根据ID查询 -->
	<select id="get" parameterType="int" resultMap="ActivityRM">
		SELECT * FROM
		website_activity
		WHERE id = #{id}
	</select>
    
    <!-- 添加 -->
	<insert id="insert" parameterType="Activity">
		INSERT INTO website_activity
		(title,content,startTime,endTime,createTime,url,image_url,status,is_end,user_id,type,updateTime,target)
		VALUES(#{title},#{content},#{startTime},#{endTime},#{createTime},#{url},#{imageUrl},#{status},#{isEnd},#{user.userId},#{type},#{updateTime},#{target})
	</insert>

    <!-- 更新 -->
	<update id="update" parameterType="Activity">
		UPDATE website_activity
		<set>
			title = #{title},content = #{content},startTime = #{startTime},endTime = #{endTime},createTime = #{createTime},is_end = #{isEnd},
			url = #{url},image_url = #{imageUrl},status = #{status},user_id = #{user.userId},type = #{type},updateTime = #{updateTime},target=#{target}
		</set>
		WHERE id = #{id}
	</update>
	
	<!-- 删除 -->
	<delete id="delete" parameterType="int" >
	   DELETE
	   FROM website_activity
	   WHERE id = #{id}
	</delete>
	
	<!-- 分页查询 -->
	<select id="pageLite" parameterType="Activity" resultMap="ActivityRM" >
	  	SELECT * FROM
		website_activity left join user on  website_activity.user_id = user.id
		<where>
		<if test="startTime != null and startTime != '' ">
			and website_activity.createTime &gt;=#{startTime}
		</if>
		<if test="endTime != null and endTime != '' ">
			and website_activity.createTime &lt;=#{endTime}
		</if>
		<if test="status != null and status != '' ">
			and website_activity.status =#{status}
		</if>
	    <if test="isEnd != null and isEnd != '' ">
			and website_activity.is_end =#{isEnd}
		</if>
		<if test="type != null and type != '' ">
			and website_activity.type =#{type}
		</if>
		
		</where>
		ORDER BY website_activity.is_end ASC,website_activity.createTime DESC
	</select>
</mapper>